<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.mapper.main.CityMapper">

    <resultMap id="basicMap"  type="hashmap">
        <id column="city_name" property="city_name" />
        <result column="city_id" property="city_id"/>
    </resultMap>

    <insert id="addCity"  parameterType="com.spring.model.City"  >
        insert into  dim_city (city_id,city_code,province_id,province_code,city,city_name,city_level)
        values(#{city_id},#{city_code},#{province_id},#{province_code},#{city},#{city_name},#{city_level});
    </insert>

    <update id="updateCity" parameterType="com.spring.model.City" >
        update dim_city set city_id=#{city_id},province_id=#{province_id},city_code=#{city_code},province_code=#{province_code}, city=#{city},city_level=#{city_level}
         where city_name=#{city_name}
    </update>

    <delete id="deleteCity" >
      delete from dim_city where city_name=#{name}
    </delete>

    <select id="findByName" resultType="com.spring.model.City" >
      select * from dim_city where city_name=#{name}
    </select>

    <select id="findByTier" parameterType="java.lang.String" resultType="java.lang.String" >
        select city_name from dim_city where city_level=#{ctiy_level}
    </select>

    <select id="citiesInProvince" parameterType="java.lang.String" resultMap="basicMap" >
        SELECT c.city_name ,c.city_id FROM  dim_province p ,dim_city c where p.province_id= c.province_id and p.province=#{name}
    </select>


    <select id="citiesOfClient" parameterType="java.lang.String" resultType="java.lang.String" >
        select cy.city_name as city_name
        from dim_client c,dim_client_city_rel ccr ,dim_city cy
        where c.client_id=ccr.client_id and ccr.city_id= cy.city_id and c.client_name= #{clientName}
    </select>

</mapper>